name: "Attachment: EICAR String Present"
description: |
  This rule detects the EICAR test string, used to evaluate Anti-Virus scanning and file inspection capabilities.

  For performance reasons, this rule is limited to attachments with "eicar" in the file name.
references:
  - "https://www.eicar.org/download-anti-malware-testfile/"
  - "https://delivr.to/payloads?id=bd6f4ec2-ef6b-4bd0-b5c7-4a9532aba783"
type: "rule"
authors:
  - twitter: "ajpc500"
severity: "low"
source: |
  type.inbound
  and any(attachments,
    .file_type in ('png', 'jpeg', 'jpg', 'bmp', 'pdf')
    and any(ml.logo_detect(.).brands, .name == "DPD")
  )

  and any(body.links, strings.levenshtein(.href_url.domain.root_domain, 'dpd.com') <= 2)
  and sender.email.domain.root_dom
tags:
  - "EICAR"
attack_types:
  - "Malware/Ransomware"
detection_methods:
  - "File analysis"
id: "592e2319-9e4f-5e3d-9b34-22259ddc3416"
